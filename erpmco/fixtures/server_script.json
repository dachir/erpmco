[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-12-31 17:26:54.253769",
  "module": "Erpmco",
  "name": "BOM Validate if Item is Linked to BOM",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Stock Entry",
  "script": "for i in doc.items:\n    if i.has_bom == 1 and i.bom_no == None:\n        frappe.throw(f\"Validate item {i.item_code} BOM before validating the current one\")",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-01-18 18:58:43.221514",
  "module": "Erpmco",
  "name": "Adjust Additional Costs",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Stock Entry",
  "script": "if doc.work_order and doc.stock_entry_type == \"Manufacture\":\r\n    work_order = frappe.get_doc(\"Work Order\", doc.work_order)\r\n\r\n    if bool(work_order.custom_use_detail_addtional_cost):\r\n        # Initialize variables\r\n        cost_dict = {}\r\n        total_cost_per_hour = 0\r\n        total_costs = doc.total_additional_costs\r\n        operations = work_order.get(\"operations\", [])\r\n\r\n        for operation in operations:\r\n            ws = frappe.get_doc(\"Workstation\", operation.workstation)\r\n            \r\n            for line in ws.get(\"custom_details\", []):\r\n                cost_dict[line.account] = cost_dict.get(line.account, 0) + line.cost\r\n                total_cost_per_hour = total_cost_per_hour + line.cost\r\n\r\n                    \r\n        # Clear `additional_costs` to avoid duplication\r\n        doc.additional_costs = []\r\n        for account, cost in cost_dict.items():\r\n            doc.append(\"additional_costs\", {\r\n                \"expense_account\": account,\r\n                \"account_currency\": \"USD\",\r\n                \"exchange_rate\": 1,\r\n                \"description\": \"Operating Cost as per Work Order / BOM\",\r\n                \"amount\": cost * total_costs / total_cost_per_hour,\r\n                \"base_amount\": cost * total_costs / total_cost_per_hour,\r\n            })\r\n            \r\n            ",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-01-20 09:33:12.837212",
  "module": "Erpmco",
  "name": "PR Manage Quality Status Before Insert",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Purchase Receipt",
  "script": "# Define conditions for item groups\r\ngroup_5k = ['ENG', 'ENGSS', 'ENGCS']\r\ngroup_all = ['ITEQP', 'ADMFO', 'LABCH', 'OFF', 'STAT']\r\n\r\n# Update quality_status for matching items\r\nfor item in doc.items:\r\n    if doc.branch:\r\n        item.branch = doc.branch\r\n        frappe.db.set_value(\"Purchase Receipt Item\", item.name, \"branch\", doc.branch)\r\n\r\n    # Get item group\r\n    item_group = frappe.db.get_value(\"Item\", item.item_code, \"item_group\")\r\n\r\n    if ((item_group in group_5k and frappe.utils.flt(item.valuation_rate) <= 5000) or (item_group in group_all)):\r\n        item.quality_status = \"5K\"\r\n        frappe.db.set_value(\"Purchase Receipt Item\", item.name, \"quality_status\", \"5K\")\r\n    else:\r\n        custom_control_quality = frappe.db.get_value(\"Item\", item.item_code, \"custom_control_quality\")\r\n        if bool(custom_control_quality):\r\n            item.quality_status = \"Q\"  if item.branch == \"Kinshasa\" else \"A\"\r\n            frappe.db.set_value(\"Purchase Receipt Item\", item.name, \"quality_status\", \"Q\"  if item.branch == \"Kinshasa\" else \"A\")\r\n        else:\r\n            item.quality_status = \"A\"\r\n            frappe.db.set_value(\"Purchase Receipt Item\", item.name, \"quality_status\", \"A\")",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-01-20 09:33:50.570519",
  "module": "Erpmco",
  "name": "PR Manage Quality Status Before Save",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Purchase Receipt",
  "script": "# Define conditions for item groups\r\ngroup_5k = ['ENG', 'ENGSS', 'ENGCS']\r\ngroup_all = ['ITEQP', 'ADMFO', 'LABCH', 'OFF', 'STAT']\r\n\r\n# Update quality_status for matching items\r\nfor item in doc.items:\r\n    if doc.branch:\r\n        item.branch = doc.branch\r\n        frappe.db.set_value(\"Purchase Receipt Item\", item.name, \"branch\", doc.branch)\r\n\r\n    # Get item group\r\n    item_group = frappe.db.get_value(\"Item\", item.item_code, \"item_group\")\r\n\r\n    if ((item_group in group_5k and frappe.utils.flt(item.valuation_rate) <= 5000) or (item_group in group_all)):\r\n        item.quality_status = \"5K\"\r\n        frappe.db.set_value(\"Purchase Receipt Item\", item.name, \"quality_status\", \"5K\")\r\n    else:\r\n        custom_control_quality = frappe.db.get_value(\"Item\", item.item_code, \"custom_control_quality\")\r\n        if bool(custom_control_quality):\r\n            item.quality_status = \"Q\"  if item.branch == \"Kinshasa\" else \"A\"\r\n            frappe.db.set_value(\"Purchase Receipt Item\", item.name, \"quality_status\", \"Q\"  if item.branch == \"Kinshasa\" else \"A\")\r\n        else:\r\n            item.quality_status = \"A\"\r\n            frappe.db.set_value(\"Purchase Receipt Item\", item.name, \"quality_status\", \"A\")",
  "script_type": "DocType Event"
 }
]